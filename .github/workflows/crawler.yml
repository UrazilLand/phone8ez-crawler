name: SmartChoice Crawler

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # ë§¤ì¼ ìì • ì‹¤í–‰ (UTC ê¸°ì¤€)

jobs:
  crawl:
    runs-on: ubuntu-latest

    steps:
    - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3

    - name: Python ì„¤ì¹˜
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'

    - name: ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Chrome ì„¤ì¹˜
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser

    - name: ì›¹ í¬ë¡¤ëŸ¬ ì‹¤í–‰
      run: |
        python smartchoice_crawler.py

    - name: 30ì¼ ì§€ë‚œ íŒŒì¼ ì‚­ì œ
      run: |
        find data/ -name '*.json' -type f -mtime +30 -print -delete
        git config --global user.name "UrazilLand Bot"
        git config --global user.email "urazilland@users.noreply.github.com"
        git add -u
        git commit -m "ğŸ§¹ 30ì¼ ì´ìƒ ì§€ë‚œ JSON íŒŒì¼ ì‚­ì œ" || echo "ì‚­ì œí•  íŒŒì¼ ì—†ìŒ"

    - name: ê²°ê³¼ ì»¤ë°‹ ë° í‘¸ì‹œ
      run: |
        git add data/*.json
        git commit -m "ğŸ“¦ í¬ë¡¤ë§ ê²°ê³¼ ì—…ë°ì´íŠ¸" || echo "ë³€ê²½ ì—†ìŒ"
        git pull --rebase origin main || echo "ì¶©ëŒ ì—†ìŒ"
        git push origin main
